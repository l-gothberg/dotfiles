# ──────────────────────────────────────────────────────────────
# Managed by chezmoi — do not edit ~/.zshrc directly
# ──────────────────────────────────────────────────────────────

# ─── OS-aware $PATH setup ─────────────────────────────────────────────
{{ if eq .chezmoi.os "darwin" -}}
    # macOS specific environment
    export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$HOME/bin:/usr/local/bin:$PATH"
{{ else if eq .chezmoi.os "linux" -}}
    # Linux specific environment
    export PATH="$HOME/bin:/usr/local/bin:$PATH"
{{ else -}}
    # Unknown OS - using safe defaults
{{ end -}}

# ─── History (increased size + better behavior) ─────────────────────────────────────────────
export HISTFILE=~/.zsh_history
export HISTSIZE=100000
export SAVEHIST=100000
setopt HIST_IGNORE_DUPS       # don't store duplicates
setopt HIST_IGNORE_SPACE      # don't store commands starting with space
setopt SHARE_HISTORY          # share history across sessions
setopt INC_APPEND_HISTORY     # append immediately (not on exit)

# ─── Modern zsh niceties ─────────────────────────────────────────────
setopt AUTO_CD                # cd by typing directory name
setopt AUTO_PUSHD             # pushd instead of cd
setopt PUSHD_IGNORE_DUPS
setopt EXTENDED_GLOB

# ─── Editor ─────────────────────────────────────────────
export EDITOR="code --wait"
export VISUAL="$EDITOR"

# ─── Enable colors in ls, grep, etc. ─────────────────────────────────────────────
autoload -U colors && colors

# ─── Completions ─────────────────────────────────────────────
autoload -Uz compinit && compinit -C
source_if_exists() { [[ -r "$1" ]] && source "$1" 2>/dev/null; }

{{ if eq .chezmoi.os "darwin" -}}
    source_if_exists "$(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
    source_if_exists "$(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
    source_if_exists "$(brew --prefix)/share/zsh-autocomplete/zsh-autocomplete.plugin.zsh"
{{ else if eq .chezmoi.os "linux" -}}
    source_if_exists "/usr/share/zsh-autocomplete/zsh-autocomplete.plugin.zsh"
{{ end -}}

# ─── Common aliases ─────────────────────────────────────────────
alias edit="code"
alias reload="source ~/.zshrc && clear"
alias ca="chezmoi apply"

# ─── OS-aware ls aliases ─────────────────────────────────────────────
{{ if eq .chezmoi.os "darwin" }}
    alias la="gls -A -F -h --group-directories-first --color=always --time-style=long-iso"
    alias ll="gls -A -F -h -l --group-directories-first --color=always --time-style=long-iso"
    alias lt="gls -A -F -h -l -t --group-directories-first --color=always --time-style=long-iso"
    alias ltr="gls -A -F -h -l -t -r --group-directories-first --color=always --time-style=long-iso"
    alias ld="gls -d .* -F -h --color=always --time-style=long-iso"
    alias l1="gls -1 -A -F -h --group-directories-first --color=always --time-style=long-iso"
    alias lx="gls -A -F -h -l -X --group-directories-first --color=always --time-style=long-iso"
    alias lk="gls -A -F -h -l -S --group-directories-first --color=always --time-style=long-iso"
{{ else if eq .chezmoi.os "linux" }}
    alias bat="batcat"     # bat package installs as batcat
    alias fd="fdfind"      # fd-find package installs as fdfind
    alias la="ls -A -F -h --group-directories-first --color=always --time-style=long-iso"
    alias ll="ls -A -F -h -l --group-directories-first --color=always --time-style=long-iso"
    alias lt="ls -A -F -h -l -t --group-directories-first --color=always --time-style=long-iso"
    alias ltr="ls -A -F -h -l -t -r --group-directories-first --color=always --time-style=long-iso"
    alias ld="ls -d .* -F -h --color=always --time-style=long-iso"
    alias l1="ls -1 -A -F -h --group-directories-first --color=always --time-style=long-iso"
    alias lx="ls -A -F -h -l -X --group-directories-first --color=always --time-style=long-iso"
    alias lk="ls -A -F -h -l -S --group-directories-first --color=always --time-style=long-iso"
{{ end }}

# ─── OS-aware package helpers
install() {
    if [ $# -eq 0 ]; then
        echo "Usage: install <package> [package...]"
        return 1
    fi
{{ if eq .chezmoi.os "darwin" }}
    brew install "$@"
{{ else if eq .chezmoi.os "linux" }}
    sudo apt update -qq
    sudo apt install -y "$@"
{{ end }}
}

uninstall() {
    if [ $# -eq 0 ]; then
        echo "Usage: uninstall <package> [package...]"
        return 1
    fi
{{ if eq .chezmoi.os "darwin" }}
    brew uninstall "$@"
    brew autoremove
{{ else if eq .chezmoi.os "linux" }}
    sudo apt purge -y "$@"
    sudo apt autoremove -y
{{ end }}
}

# ─── Starship prompt ─────────────────────────────────────────────
if command -v starship >/dev/null 2>&1; then
    eval "$(starship init zsh)"
fi

# ─── Ghostty shell integration fallback ──────────────────────────
if [[ -n "$GHOSTTY_RESOURCES_DIR" && -r "${GHOSTTY_RESOURCES_DIR}/shell-integration/zsh/ghostty-integration" ]]; then
    source "${GHOSTTY_RESOURCES_DIR}/shell-integration/zsh/ghostty-integration"
fi